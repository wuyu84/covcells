#生成模板----
y=x
for (i in 1:10) {
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,zuotu$职业[i],.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
}
#生成模板----
y=x
for (i in 1:5) {
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,zuotu$职业[i],.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
}
#生成模板----
y=x
for (i in 1:3) {
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,zuotu$职业[i],.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
}
#生成模板----
y=x
for (i in 1:2) {
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,zuotu$职业[i],.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
}
#生成模板----
i=3
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
zuotu$采样[i]
View(zuotu)
y=gsub(k1,zuotu$采样[i],y)
zuotu$街道[i]
zuotu$姓名[i]
zuotu$报告[i]
zuotu$职业[i]
as.character(NA)
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,as.character(职业[i]),.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,as.character(zuotu$职业[i]),.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
zuotu[is.na(zuotu)]=''
y=x
for (i in 1:3) {
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,zuotu$职业[i],.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
}
cellsmake=function(zuotu){
zuotu[is.na(zuotu)]=''
#读取模板设定参数----
x=read_lines('./man/元素模板库-职业版.txt')
dis_col=data.frame(
quhua=c("福田", "南山", "罗湖", "宝安", "龙岗",
"盐田", "龙华",'坪山','光明','大鹏','深汕'),
yanse=c('255,183,77','255,241,118','100,180,246','0,255,255','0,255,0',
'27,94,31','186,104,200','242,8,160','161,105,56','229,155,155','255,255,255')
)
dis_col_font=data.frame(
quhua=c("福田", "南山", "罗湖", "宝安", "龙岗",
"盐田", "龙华",'坪山','光明','大鹏','深汕'),
yanse=c('0,0,0','0,0,0','0,0,0','0,0,0','0,0,0',
'255,255,255','255,255,255','255,255,255','255,255,255','255,255,255','0,0,0')
)
fway_col=data.frame(
faxian=c('社会面','隔离管控'),
yanse=c('255,0,0','13,71,161')
)
#生成模板----
y=x
for (i in 1:nrow(zuotu)) {
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,zuotu$职业[i],.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
}
return(y)
}
cellsmake(zuotu)
yy=cellsmake(zuotu)
cellsmake=function(zuotu){
zuotu[is.na(zuotu)]=''
#读取模板设定参数----
x=read_lines('./man/元素模板库-职业版.txt')
dis_col=data.frame(
quhua=c("福田", "南山", "罗湖", "宝安", "龙岗",
"盐田", "龙华",'坪山','光明','大鹏','深汕'),
yanse=c('255,183,77','255,241,118','100,180,246','0,255,255','0,255,0',
'27,94,31','186,104,200','242,8,160','161,105,56','229,155,155','255,255,255')
)
dis_col_font=data.frame(
quhua=c("福田", "南山", "罗湖", "宝安", "龙岗",
"盐田", "龙华",'坪山','光明','大鹏','深汕'),
yanse=c('0,0,0','0,0,0','0,0,0','0,0,0','0,0,0',
'255,255,255','255,255,255','255,255,255','255,255,255','255,255,255','0,0,0')
)
fway_col=data.frame(
faxian=c('社会面','隔离管控'),
yanse=c('255,0,0','13,71,161')
)
#生成模板----
y=x
for (i in 1:nrow(zuotu)) {
k1=paste('采样',sprintf("%02s",i),sep='')
k2=paste('街道',sprintf("%02s",i),sep='')
k3=paste('姓名',sprintf("%02s",i),sep='')
k4=paste('报告',sprintf("%02s",i),sep='')
k5=paste('职业',sprintf("%02s",i),sep='')
col_sample0=paste(i*10,i*10,i*10,sep=',')
col_sample1=fway_col$yanse[fway_col$faxian==zuotu$社会面[i]]
col_qu0=paste(i*10+5,i*10+5,i*10+5,sep=',')
col_qu1=dis_col$yanse[dis_col$quhua==zuotu$管辖区[i]]
col_qu0_font=paste(i*10+8,i*10+8,i*10+8,sep=',')
col_qu1_font=dis_col_font$yanse[dis_col_font$quhua==zuotu$管辖区[i]]
y=gsub(k1,zuotu$采样[i],y)%>%
gsub(k2,zuotu$街道[i],.)%>%
gsub(k3,zuotu$姓名[i],.)%>%
gsub(k4,zuotu$报告[i],.)%>%
gsub(k5,zuotu$职业[i],.)%>%
gsub(col_sample0,col_sample1,.)%>%
gsub(col_qu0,col_qu1,.)%>%
gsub(col_qu0_font,col_qu1_font,.)
}
write_lines(y,'shengch.pos')
}
cellsmake(zuotu)
fname=paste('待做图元素库',today()%>%format('%m%d'),'.pos',sep='')
write_lines(y,fname)
library(covcells)
library(tidyverse)
library(xml2)
library(rvest)
setwd('C:/Users/szcdc/Desktop/0811起/')
setwd('/Users/wuyu/Downloads')
pacman::p_load(plyr,tidyverse,myfunc,kableExtra,docxtractr,lubridate,readxl,dplyr)
pacman::p_load(crosstable)
ur1<-"911以来0911-24.svg"
wpage=read_html(ur1,encoding='UTF-8')
h1=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur2<-"823以来疫情全个案.svg"
wpage=read_html(ur2,encoding='UTF-8')
h2=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur3<-"华星专场0910-8.svg"
wpage=read_html(ur3,encoding='UTF-8')
h3=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
gyds=readxl::read_xlsx('广业大厦专项.xlsx')
hb=c(h1,h2,h3,gyds$姓名)%>%unique
ur1<-"911以来0911-12.svg"
wpage=read_html(ur1,encoding='UTF-8')
h1=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
hb=c(h1,h2,h3,gyds$姓名)%>%unique
dz=readxl::read_xlsx('0912 1200 0811深圳本地疫情一览表.xlsx',sheet = '0811')%>% dcdate()%>%
dplyr::rename('初阳采样jx'='初筛阳性采样时间（简讯）',
'初阳采样yhs'='初筛阳性采样时间（粤核酸）') %>%
filter(新增时间>as.Date('2022-8-27'))%>%
mutate(地址=gsub("广东省",'',患者家庭地址) %>%gsub("深圳市",'',.),
管辖区=gsub('区','',管辖区),
街道=gsub('街道','',街道),
报告=paste(month(新增时间),sprintf('%02d',day(新增时间)),sep=''))%>%
dplyr::rename('职业'='具体岗位')%>%
mutate(采样=rowMin(data.frame(初阳采样jx,初阳采样yhs)))%>%
select(all_of(c('管辖区','街道','采样','报告','姓名','社会面','关联','备注...19',
'地址','患者工作单位','人群分类','职业')))%>%
mutate(采样=paste(month(采样),'-',day(采样),sep=''))%>%
filter(!姓名%in% hb)%>%
filter(!grepl('0',姓名))%>%
filter(!grepl('混一',姓名))%>%
arrange(管辖区,街道)%>%
filter(!姓名=='吴志娟')
library(covcells)
cellsmake(dz[1:20,])
library(covcells)
cellsmake(dz[1:20,])
library(covcells)
library(covcells)
library(tidyverse)
library(xml2)
library(rvest)
setwd('C:/Users/szcdc/Desktop/0811起/')
setwd('/Users/wuyu/Downloads')
pacman::p_load(plyr,tidyverse,myfunc,kableExtra,docxtractr,lubridate,readxl,dplyr)
pacman::p_load(crosstable)
ur1<-"911以来0911-12.svg"
wpage=read_html(ur1,encoding='UTF-8')
h1=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur2<-"823以来疫情全个案.svg"
wpage=read_html(ur2,encoding='UTF-8')
h2=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur3<-"华星专场0910-8.svg"
wpage=read_html(ur3,encoding='UTF-8')
h3=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
gyds=readxl::read_xlsx('广业大厦专项.xlsx')
hb=c(h1,h2,h3,gyds$姓名)%>%unique
dz=readxl::read_xlsx('0912 1200 0811深圳本地疫情一览表.xlsx',sheet = '0811')%>% dcdate()%>%
dplyr::rename('初阳采样jx'='初筛阳性采样时间（简讯）',
'初阳采样yhs'='初筛阳性采样时间（粤核酸）') %>%
filter(新增时间>as.Date('2022-8-27'))%>%
mutate(地址=gsub("广东省",'',患者家庭地址) %>%gsub("深圳市",'',.),
管辖区=gsub('区','',管辖区),
街道=gsub('街道','',街道),
报告=paste(month(新增时间),sprintf('%02d',day(新增时间)),sep=''))%>%
dplyr::rename('职业'='具体岗位')%>%
mutate(采样=rowMin(data.frame(初阳采样jx,初阳采样yhs)))%>%
select(all_of(c('管辖区','街道','采样','报告','姓名','社会面','关联','备注...19',
'地址','患者工作单位','人群分类','职业')))%>%
mutate(采样=paste(month(采样),'-',day(采样),sep=''))%>%
filter(!姓名%in% hb)%>%
filter(!grepl('0',姓名))%>%
filter(!grepl('混一',姓名))%>%
arrange(管辖区,街道)%>%
filter(!姓名=='吴志娟')
writexl::write_xlsx(dz[1:20,],'待做图.xlsx')
zuotu=read_xlsx('待做图.xlsx')%>%
mutate(职业=ifelse(is.na(职业),' ',职业))
ur1<-"911以来0911-8.svg"
wpage=read_html(ur1,encoding='UTF-8')
h1=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
hb=c(h1,h2,h3,gyds$姓名)%>%unique
dz=readxl::read_xlsx('0912 1200 0811深圳本地疫情一览表.xlsx',sheet = '0811')%>% dcdate()%>%
dplyr::rename('初阳采样jx'='初筛阳性采样时间（简讯）',
'初阳采样yhs'='初筛阳性采样时间（粤核酸）') %>%
filter(新增时间>as.Date('2022-8-27'))%>%
mutate(地址=gsub("广东省",'',患者家庭地址) %>%gsub("深圳市",'',.),
管辖区=gsub('区','',管辖区),
街道=gsub('街道','',街道),
报告=paste(month(新增时间),sprintf('%02d',day(新增时间)),sep=''))%>%
dplyr::rename('职业'='具体岗位')%>%
mutate(采样=rowMin(data.frame(初阳采样jx,初阳采样yhs)))%>%
select(all_of(c('管辖区','街道','采样','报告','姓名','社会面','关联','备注...19',
'地址','患者工作单位','人群分类','职业')))%>%
mutate(采样=paste(month(采样),'-',day(采样),sep=''))%>%
filter(!姓名%in% hb)%>%
filter(!grepl('0',姓名))%>%
filter(!grepl('混一',姓名))%>%
arrange(管辖区,街道)%>%
filter(!姓名=='吴志娟')
zuotu=read_xlsx('待做图.xlsx')%>%
mutate(职业=ifelse(is.na(职业),' ',职业))
nid=read_xlsx('0828起新冠数据看板场所版(简版) 0905以后.xlsx',sheet='数据')%>%
select(编号,姓名)
zuotu=left_join(zuotu,nid)%>%
mutate(报告=paste(报告,'-',编号,sep=''))
writexl::write_xlsx(dz[1:20,],'待做图.xlsx')
writexl::write_xlsx(dz[1:20,],'待做图.xlsx')
??baidumig
devtools::install_github('wuyu84/covcells')
library(covcells)
library(covcells)
library(covcells)
library(covcells)
??covcells
devtools::install_github('wuyu84/covcells')
library(covcells)
library(covcells)
library(covcells)
library(covcells)
detach("package:covcells", unload = TRUE)
library(covcells)
remove.packages("covcells")
devtools::install_github('wuyu84/covcells')
library(covcells)
remove.packages("covcells")
devtools::install_github('wuyu84/covcells')
library(covcells)
library(tidyverse)
library(xml2)
library(rvest)
setwd('C:/Users/szcdc/Desktop/0811起/')
setwd('/Users/wuyu/Downloads')
pacman::p_load(plyr,tidyverse,myfunc,kableExtra,docxtractr,lubridate,readxl,dplyr)
pacman::p_load(crosstable)
ur1<-"828以来疫情0911-24.svg"
wpage=read_html(ur1,encoding='UTF-8')
h1=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur2<-"823以来疫情全个案.svg"
wpage=read_html(ur2,encoding='UTF-8')
h2=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur3<-"华星专场0910-8.svg"
wpage=read_html(ur3,encoding='UTF-8')
h3=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
gyds=readxl::read_xlsx('广业大厦专项.xlsx')
hb=c(h1,h2,h3,gyds$姓名)%>%unique
dz=readxl::read_xlsx('0912 1200 0811深圳本地疫情一览表.xlsx',sheet = '0811')%>% dcdate()%>%
dplyr::rename('初阳采样jx'='初筛阳性采样时间（简讯）',
'初阳采样yhs'='初筛阳性采样时间（粤核酸）') %>%
filter(新增时间>as.Date('2022-8-27'))%>%
mutate(地址=gsub("广东省",'',患者家庭地址) %>%gsub("深圳市",'',.),
管辖区=gsub('区','',管辖区),
街道=gsub('街道','',街道),
报告=paste(month(新增时间),sprintf('%02d',day(新增时间)),sep=''))%>%
dplyr::rename('职业'='具体岗位')%>%
mutate(采样=rowMin(data.frame(初阳采样jx,初阳采样yhs)))%>%
select(all_of(c('管辖区','街道','采样','报告','姓名','社会面','关联','备注...19',
'地址','患者工作单位','人群分类','职业')))%>%
mutate(采样=paste(month(采样),'-',day(采样),sep=''))%>%
filter(!姓名%in% hb)%>%
filter(!grepl('0',姓名))%>%
filter(!grepl('混一',姓名))%>%
arrange(管辖区,街道)%>%
filter(!姓名=='吴志娟')
cellsmake(dz)
x=read_lines('./man/元素模板库-职业版.txt')
if (!require(readr)) install.packages("readr")
if (!require(lubridate)) install.packages("lubridate")
if (!require(magrittr)) install.packages("magrittr")
#读取模板设定参数----
x=read_lines('./man/元素模板库-职业版.txt')
save(x,'元素模板库.rda')
save(x,file = '元素模板库.rda')
cellmodels=x
save(cellmodels,file = '元素模板库.rda')
remove.packages("covcells")
devtools::install_github('wuyu84/covcells')
library(covcells)
View(cellsmake)
library(tidyverse)
library(xml2)
library(rvest)
setwd('C:/Users/szcdc/Desktop/0811起/')
setwd('/Users/wuyu/Downloads')
pacman::p_load(plyr,tidyverse,myfunc,kableExtra,docxtractr,lubridate,readxl,dplyr)
pacman::p_load(crosstable)
ur1<-"828以来疫情0911-24.svg"
wpage=read_html(ur1,encoding='UTF-8')
h1=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur2<-"823以来疫情全个案.svg"
wpage=read_html(ur2,encoding='UTF-8')
h2=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
ur3<-"华星专场0910-8.svg"
wpage=read_html(ur3,encoding='UTF-8')
h3=wpage%>%html_nodes('svg g g text')%>%
html_text%>%unique()%>%
.[!grepl('[0-9]',.)]
gyds=readxl::read_xlsx('广业大厦专项.xlsx')
hb=c(h1,h2,h3,gyds$姓名)%>%unique
dz=readxl::read_xlsx('0912 1200 0811深圳本地疫情一览表.xlsx',sheet = '0811')%>% dcdate()%>%
dplyr::rename('初阳采样jx'='初筛阳性采样时间（简讯）',
'初阳采样yhs'='初筛阳性采样时间（粤核酸）') %>%
filter(新增时间>as.Date('2022-8-27'))%>%
mutate(地址=gsub("广东省",'',患者家庭地址) %>%gsub("深圳市",'',.),
管辖区=gsub('区','',管辖区),
街道=gsub('街道','',街道),
报告=paste(month(新增时间),sprintf('%02d',day(新增时间)),sep=''))%>%
dplyr::rename('职业'='具体岗位')%>%
mutate(采样=rowMin(data.frame(初阳采样jx,初阳采样yhs)))%>%
select(all_of(c('管辖区','街道','采样','报告','姓名','社会面','关联','备注...19',
'地址','患者工作单位','人群分类','职业')))%>%
mutate(采样=paste(month(采样),'-',day(采样),sep=''))%>%
filter(!姓名%in% hb)%>%
filter(!grepl('0',姓名))%>%
filter(!grepl('混一',姓名))%>%
arrange(管辖区,街道)%>%
filter(!姓名=='吴志娟')
library(covcells)
cellsmake(dz)
cellsmake(dz)
View(cellsmake)
devtools::install_github('wuyu84/covcells')
library(covcells)
library(covcells)
cellsmake(dz)
remove.packages("covcells")
devtools::install_github('wuyu84/covcells')
library(covcells)
cellsmake(dz)
library(covcells)
cellsmake(dz)
